name: Require Issue Reference in PR

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  check-issue:
    runs-on: ubuntu-latest
    permissions:
      pull-requests: write
      issues: write

    steps:
      - name: Check for issue reference
        uses: actions/github-script@v7
        with:
          script: |
            const prBody = context.payload.pull_request.body || "";

            // Match #12, Fixes #12, Closes #12 etc.
            const issueRegex = /(close[sd]?|fix(e[sd])?|resolve[sd]?)?\s*#\d+/i;

            if (!issueRegex.test(prBody)) {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: context.payload.pull_request.number,
                body: "‚ùå This PR does not reference any issue. Please add something like: Fixes #12"
              });

              core.setFailed("No issue reference found in PR description.");
            }
